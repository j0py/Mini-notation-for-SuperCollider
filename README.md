# Mini-notation-for-SuperCollider
Use Tidal Mini notation in a Pbind.

When exploring Tidal i liked the short "mini notation" syntax a lot.  
Wish we had that as an option in SuperCollider.. now, we do!

In Tidal you specify things like so: ```"bd:1 ~ sn:3 hh"```.

This string specifies what should happen during a "cycle".

In the example we see 4 steps in the cycle, separated by spaces.   
In step 1 sample number 1 from the "bd" samples is played.   
Step 2 is a Rest step.
Step 3 plays sample number 3 from the "sn" samples.  
Step 4 plays sample 0 from the "hh" samples.   

The colon is optional; it divides the step in a ```string:number```. You can omit the colon and the number, and in that case number 0 is assumed.

The part before the colon may also be a synthdef name, and then the number after the colon is interpreted as a note number (degree).

A mini-notation string like above can specify a lot for a Pbind:

When playing a sample:
- the \dur is specified: 4 steps each with duration 0.25 (1 cycle = 1 beat)
- the \instrument is assumed a \playbuf synthdef which needs a \bufnum.
- the \bufnum can be calculated from sample name and sample number.
- the \type is \note, but if "~" is encountered, the \type = \rest.

When playing a synthdef:
- the \dur is specified like with the sample above.
- the \instrument is the string part before the colon (a synthdef).
- the \degree is the part after the colon (an integer).
- the \type can be generated as with the sample above.

Tidal uses this notation multiple times on one line to specify multiple things. ```$ bd:1 ~ sn:2 hh # 3 0 1 2``` Specifies the same as above, only after the ```#``` a second mini-notated string is specified, which overrides the _number_ values of the ```$``` string before it.

## Samples

Samples are expected in ```Library.at(\samples)```.

If you have a "samples" folder in the same folder as your current .scd file, then you could do this:

```
s.waitForBoot({
	("samples".resolveRelative +/+ "*").pathMatch.do({ |bank|
		Library.put(
			\samples,
			bank.basename.withoutTrailingSlash.asSymbol,
			(bank +/+ "*.*").pathMatch.collect({ |file|
				Buffer.read(s, file)
			})
		);
	});
	s.sync;
});
```

This would read ALL files (.wav, .aiff, etc) as samples into the library.

Each sub-folder of the "samples" folder will appear in the Library under the \samples key, and it will hold an Array with audio Buffers read from the files that were found in the sub-folder.

## The idea

We could use mini-notation in a ProxySpace to specify keys for a Pbind like so:

```
~a.play;
~a[0] = Pbindf(
	Mbind("S bd:2 hh:1 cl:1 sn:7 N 1 2 3 A 6 2 P -9 9"),
	\amp, Mnum("0.25 <0.5 1> 0.75"),
	\pan, Pwhite(-1, 1),
);
```

The Mbind generates a Pbind, and the Mnum generates a Pattern.

### Mbind

The Mbind class returns a Pbind based on the given mini-notation string.  

In fact, you can give it 4 mini-notation strings: S is for the sound, N is for the number, A is for \amp, P is for \pan. All 4 are optional.

All 4 mini-notation strings are capable of delivering the \dur pattern for the Pbind, so which one should be used?

The _first_ specified string will deliver the \dur pattern, but it is overridden by the _last_ specified string which has an extra + sign added.

```Mbind("S bd:2 hh:1 cl:1 sn:7 N 1 2 3 A+ 6 2 2 P -9 9"),```

The \dur pattern generated by the S part is not used in the final Pbind, but instead the \dur pattern generated by the A part is used. This would give a triplet feel with accent on each first note.

Amp, by the way, is specified as an Integer number from 0 - 9. It is divided by 9 internally, so the range ultimately is 0.0 - 1.0. This way, the notation is shortened a bit.

Pan is specified as an Integer from -9 to 9, and also divided by 9, resulting in -1.0, 1.0 range. Having to write things like 0.33 or 0.45 is cumbursome, so just a simple 1-digit number, which will be divided by 9 will work faster. How many different panning positions do you need?

### Mnum

Mnum can generate a Pattern for you:

```
	\xxx, Mnum("0.25 <0.5 1> 0.75"),
```

Mnum will parse the mini-notation string, and only use the string parts before the colons. So when using Mnum, you always omit the colons and numbers, like above. Each string will we converted to a floating point number, and these values will be returned as a Pseq pattern.

In the example above you see two strange characters: ```< and >```.   
These are part of the mini-notation as defined for the Tidal language.   
I have not incorporated all mini-notation options, but a useable bunch of them.

## Mini-notation options

### Nesting, alternating

Nesting (```[step1 step2 ..]```) puts one or more steps in the duration space of one step. Samples/notes are thus played faster.

Alternating (```<step1 step2 ..>```) will alternate the steps between the brackets. The first step is played during the first cycle, and during the next cycle, the second step will be played (if any) and so on.

You may nest these things as deep as you want.

### Speed

```*``` ```"bd sn*1.5"``` plays 1.5 snare steps inside 1 step.

This is a bit tricky: during the step with duration 0.5, 1.5 snare-steps are played.   
That means, in cycle 0, a snare is played at the beginning of the 0.5 duration space, and another is played at 2/3 of the 0.5 beat duration.
In cycle 1, the 0.5 beat duration will start with silence from the snare step from cycle 0, and on 1/3 of the 0.5 beat duration, a snare will be played. This last snare will exactly fill up the cycle. Cycle 2 will be the same as cycle 0, cycle 3 the same as cycle 1, etc.   
The result is, that the snaredrum plays 1.5 times faster "through" the rhythm.

```/``` ```"bd sn/1.5"``` like above, but plays snare 1.5 times slower.

```@``` ```[bd sn@0.5]``` makes duration of the snare half as long

You may also speed up nested groups of course!

```"bd [hh <hh cl> hh]/2 <~ sn> hh"```

## Installation

Use ```git clone``` to get the sources somewhere on disk (just 1 file).

Create a symbolic link inside the ```~/.local/share/SuperCollider/Extensions``` folder, pointing to the place where you have cloned this repository to.

Like this: ```ln -s /somewhere/on/disk/cloned-repository mini```.

In Extensions folder, you now have a symbolic link named "mini" pointing to the contents of the repository.

Start SuperCollider (this will recompile all classes) and the Mbind / Mnum classes should be available. SuperCollider will follow the symbolic link and discover the source file(s) of the extensions.

The name of the symbolic link ("mini") may be anything.

This is how you can install it on Linux. Without using symbolic links, you can of course just copy ```mini.sc``` into Extensions folder directly. But using a clones Github repository makes updating easier (or collaborating!).

## Future plans/ideas

The mini-notation parser itself could use some more capabilities:

```,``` paralell running steps

```!``` repeat the last step, e.g.: ```"bd bd bd"``` = ```"bd bd!"``` = ```"bd!3"```

```bd(3,8)``` euclidian rhythms ( ```bd:2(3,8)``` is also possible )

The string for Mbind splits into parts by using uppercase letters.   
Each uppercase letter indicates what part immediately following it means.

* (S)ound
* (N)umber
* (A)mp
* (P)an

This makes it easy to add more letters / features.

## James Harkins notation.

The other day i discovered the notation system of James Harkins, who is also inspired by Tidal. In his notation, each character stands for 1 step of the cycle.

So specifying a cycle of 4 steps only takes 4 characters!

There are 2 special characters in his notation: the _space_ character does not play a note or a rest, but it just takes up the time of 1 step. Any note played before the space will continue to sound. The "x" character plays a rest. Any note played before it will end when the rest is played.

Consider this 4 step sequence, using a long sounding Crash cymbal sample:

```"S cr N 1 2 "``` would hit Crash cymbal sample 1, let it sound until step 3, and in step 3 hit Crash cymbal sample 2.

```"S cr N 1x2 "``` would hit Crash cymbal sample 1, choke it in step 2, and in step 3 hit Crash cymbal sample 2.

In Tidal mini-notation, you would have to do this:

```"S bd N 1 2"``` We make the cycle have just 2 steps.

```"S bd N 1 ~ 2@1.5"``` To choke the Crash, we have to add a rest in step 2. But then the cycle has 3 steps, which gives a triplet feel, and we do not want that. So we have to specify step 3 to have a longer duration. It gets 1/3 but we want it to have 1/2 duration, so we multiply the step using "@" by a factor 3/2.

In this situation, i favor James' notation over the Tidal one. Especially because the length of the notation stays 4 characters and you do not have to calculate how to get from 1/3 to 1/2. You just "see it".

Would _nesting_ and _alternating_ be possible using James' notation?

Tidal: ```"S hh N 1 [1 [~ 2]] 1 4"``` End step 2 with an extra 16th hh hit.

James: ```"S hh N 1|1  2|1|4"``` Using ```|``` to mark the steps.

Tidal: ```"S hh N 1 [1 <7 2>] 1 4"``` Double step 2 with an extra hh. Alternate between hh sample 7 and 2.

James: ```"S hh N 1|1<72>|1|4"``` Perfectly possible!

A little more complicated maybe:  
The second step should get an extra 16th hh at the end, using sample number 2 during even cycles, but during odd cycles, two 32nd hh strokes must be used using sample numbers 8 and 9.

Tidal: ```"S hh N 1 [1 [~ <2 [8 9]>]] 1 4"```

James: ```"S hh N 1|1  <2|89>|1|4"```

In Tidal you can specify more than 1 sample / synthdef in one line.  
Using James' notation this is only possible when using the "|" character to separate the steps.

But in practice i think it is better to separate the instruments in separate Pbind's / NodeProxies, because you want different effects, pannings etc.

Using "x" for a rest frees the "~" to create a glissando, which would be nice to have. The glissando could then be used for the degree (gliding pitch), but also any other Pbind parameter (gliding \amp, gliding \pan, maybe even gliding \dur).

```"S sn N 1111 A 0~9"``` During one cycle, we hear 4 snaredrum hits, with amplitudes 0, 0.25, 0.5, 0.75. Amplitude 1 is reached at the _end_ of step 4.

I think i will first redo Pnum so that it supports James' notation, and i will name that Pmini. It will check the given string: if it has uppercase letters, then it will generate a Pbind ("N" will supply \dur).  
If it does not contain uppercase letters then it will generate a Pseq returning float values:

```
~a.play;
~a[0] = Pbindf(
	Pmini("S bd N 12 1"),       // bass drum rhythm specifying sample numbers
	\amp, Pmini("1<24>3") / 4,  // triplet feel amp pattern
	\pan, Pmini("0~2") - 1,     // gliding pan pattern
);
```



